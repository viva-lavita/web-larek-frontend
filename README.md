# Проектная работа "Веб-ларек"

Интернет-магазин с товарами для веб-разработчиков. В нём можно посмотреть каталог товаров, добавить товары в корзину и сделать заказ.

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```


--

## Архитектура

Архитектура проекта разрабатывается с использованием паттерна MVP, в котором основными слоями являются:

- `M` - модели данных, слой отвечающий за работу с данными;
- `V` - view, компоненты представления отвечающие за отображение данных, слой отображения;
- `P` - presenter - управляющий слой. Код презентера не выделен в отдельный класс, а содержится в основном скрипте приложения index.ts.

Также есть коммуникационный слой представленный классом ItemAPI, который позволяет получать данные с сервера.

В проекте мы используем событийно-ориентированный подход.

Состояние приложения описывается через главную модель данных `AppData`, которая реализована с использованием паттерна Синглтон, а также использует композицию классов,

### Типы и интерфейсы описанные в приложении

Модель, отвечающая за получение данных о товарах с сервера. <br>
Несмотря на то, что ограничения алиаса `categoryType` после компиляции в js полностью исчезнут, а значение данного поля приходит с сервера, данное выделение вариантов здесь указано большей частью для поддержания стилистики максимальной типизации и облегчения понимания кода.

```ts

type categoryType =
	| 'софт-скил'
	| 'другое'
	| 'дополнительное'
	| 'кнопка'
	| 'хардскил';

export type IItemServe = {
	id: string;
	title: string;
	price: number | null;
	description: string;
	image: string;
	category: categoryType;
};

```

--

Расширенный тип данных товара. <br>
Этот тип данных используется для описания данных, которые возвращаются из функции получения данных с сервера. <br>

Добавлены поля:

- `selected` - вынесенный в отдельное поле флаг выбора товара пользователем.
- `index` - опциональное поле, используется для отображения порядкового номера товара в корзине, вместо динамической нумерации по факту при отображении модального окна корзины.

Цель выноса в отдельные поля - меньшая нагрузка на браузер пользователя, своеобразное кэширование, обмен памяти на быстродействие. Также так удобнее работать с кодом, хотя и нарушается принцип единого источника..

Также скорректирован тип входящих данных поля price - null заменен на 0, полностью приведено к number.

```ts

export type IItem = IItemServe & {
	price: number;
	selected: boolean;
	index?: number;
};

```

--

Интерфейс модели хранения информации о товаре. <br>
Прописаны методы получения товара по id и выбора товара пользователем (изменение флага selected). Удобно использовать при отображении карточек. <br>
id в формате string, так в бд сервера используются pk формата UUID.

```ts

export interface IItemsData {
	items: IItem[];
	selectItem(id: string): void;
	getItem(id: string): IItem | null;
}

```

--

Интерфейс класса получения данных о товаре с сервера. Коммуникационный слой. <br>

Прописаны методы получения одного или нескольких товаров, получение одного товара в приложении не используется, но данный интерфейс присутствует в серверном API.

```ts

export interface IItemAPI {
	getItems(): Promise<IItem[]>;
	getItem(id: string): Promise<IItem>;
	makeOrder(order: IOrderData): Promise<IOrderResponse | OrderError>;
}

```

--

Класс хранения состояния корзины. <br>
Прописаны методы добавления, удаления и очистки корзины. <br> 
При удалении и очистке сбрасываются или пересчитываются индексы товаров.

Индексы используются только корзиной, поэтому работа с ними ведется только в этом классе, при выходе за его пределы индексы сбрасываются. Флаг же selected используется только классом товара, поэтому работа с ним прописана в классе ItemsData.

```ts

export interface IBasketData {
	items: IItem[];
	totalPrice: number;
	addItem(item: IItem): void;
	removeItem(item: IItem): void;
	clearBasket(): void;
}

```

--

Интерфейсы классов отображения форм оформления заказа. <br>
В приложении две формы, поэтому используется два класса отображений. <br>

Метод render прописан в абстрактном классе, от которого наследуются эти классы форм.
По дефолту в форме заказа выбирается (и отображается) форма оплаты `online`.

```ts

export type ITypePayment = 'cash' | 'online';

export interface IOrderForm {
	payment: ITypePayment;
	address: string;
}

export interface IOrderContactForm {
	email: string;
	phone: string;
}

```

--

Тип описывающий данные, которые необходимы для отправки заказа на сервер. <br>
Данный тип используется только в методе getOrder и классе API - как описание структуры передаваемого аргумента, поэтому реализовано как тип, а не интерфейс.

```ts

type IOrder = IOrderForm & IOrderContactForm & {
    total: number;
    items: IItem['id'][];
}

```

--

Класс хранения информации о текущем заказе. <br>
Прописаны методы добавления, удаления товаров из корзины, очистка корзины и получение заказа для отправки на сервер. <br>
Работа с данными ведется только через интерфейс.

```ts

export interface IOrderData extends IOrder {
	addItem(item: IItem): void;
	removeItem(item: IItem): void;
	clearOrder(): void;
    getOrder(): IOrder;
}

```

--

Описание структуры вариантов ответов сервера, после обработки функцией `makeOrder` в классе ItemAPI - успешный заказ и ошибка. <br>
Ошибка является классом,  вызывается в функции makeOrder и расширяет базовый класс Error, поэтому реализована интерфейсом, а не типом.

```ts

export type IOrderResponse = {
    id: string;
    total: number;
}

export interface IOrderError extends Error {
	error: string;
}

```

--

Описание структуры поля сохранения ошибок валидации форм. <br>
Объект ключ-значение формата строки, пример {'phone': 'Поле номера телефона должно быть заполнено'}.

```ts

export type FormErrors = Record<string, string>;

```

--

Класс управления состоянием приложения. <br>
Интерфейс IAppData представляет состояние приложения и предоставляет методы для работы с этим состоянием. Класс управляет данными, связанными с товарами, корзиной покупок, оплатой и заказами, а также выполняет бизнес-логику, связанную с обработкой этих данных.

Свойства

- **items**: IItem[]  
  Хранит список доступных товаров.

- **basket**: IItem[]  
  Хранит товары, выбранные пользователем.

- **totalPrice**: number  
  Содержит общую стоимость товаров в корзине.

- **preview**: IItem | null  
  Позволяет пользователю просматривать информацию о выбранном товаре. Может быть null, если предварительный просмотр не установлен.

- **formErrors**: FormErrors  
  Хранит ошибки валидации формы, возникающие при проверке данных заказа или контактной информации.

Методы

- **getOrder**: () => IOrder  
  Получает текущий заказ, включая информацию о товарах и способе оплаты.  
  **Возвращает**: Объект текущего заказа.

- **setCatalog**: (items: IItem[]) => void  
  Устанавливает каталог товаров, обновляя список доступных товаров в приложении.  
  **Параметры**:
  - items: Новый список товаров.

- **selectItem**: (item: IItem) => void  
  Выбирает товар и добавляет его в корзину покупок.  
  **Параметры**:
  - item: Товар для выбора.

- **unselectItem**: (item: IItem) => void  
  Отменяет выбор товара и удаляет его из корзины покупок.  
  **Параметры**:
  - item: Товар для отмены выбора.

- **setPreview**: (item: IItem) => void  
  Устанавливает предварительный просмотр выбранного товара.  
  **Параметры**:
  - item: Товар для предварительного просмотра.

- **setPayment**: (payment: ITypePayment) => void  
  Устанавливает способ оплаты для текущего заказа.  
  **Параметры**:
  - payment: Способ оплаты.

- **setOrderField**: (field: keyof Pick<IOrderData, 'payment' | 'address'>, value: string) => void  
  Устанавливает значение поля заказа (например, адрес или способ оплаты).  
  **Параметры**:
  - field: Поле заказа для обновления.
  - value: Новое значение поля.

- **setOrderFieldContacts**: (field: keyof Pick<IOrderData, 'email' | 'phone'>, value: string) => void  
  Устанавливает значение контактного поля заказа (например, email или телефон).  
  **Параметры**:
  - field: Поле контакта для обновления.
  - value: Новое значение поля контакта.

- **validateOrder**: () => boolean  
  Проверяет валидность данных заказа.  
  **Возвращает**: true, если данные валидны; иначе false.

- **validateContacts**: () => boolean  
  Проверяет валидность контактных данных пользователя.  
  **Возвращает**: true, если данные валидны; иначе false.

- **clearBasket**: () => void  
  Очищает корзину покупок, удаляя все товары из нее.

```ts

export interface IAppData {
	items: IItem[];
	basket: IItem[];
	totalPrice: number;
	preview: IItem | null;
	formErrors: FormErrors;
	getOrder: () => IOrder;
	setCatalog: (items: IItem[]) => void;
	selectItem: (item: IItem) => void;
	unselectItem: (item: IItem) => void;
	setPreview: (item: IItem) => void;
	setPayment: (payment: ITypePayment) => void;
	setOrderField: (
		field: keyof Pick<IOrderData, 'payment' | 'address'>,
		value: string
	) => void;
	setOrderFieldContacts: (
		field: keyof Pick<IOrderData, 'email' | 'phone'>,
		value: string
	) => void;
	validateOrder: () => boolean;
	validateContacts: () => boolean;
	clearBasket: () => void;
}

```

### Базовые классы

В приложении в папке `src/components/base` прописаны абстрактные и базовые классы для компонентов приложения. Абстрактные классы предназначены для упрощения разработки, так как прописывают в себе общую функциональность для схожих компонентов разных слоев, что помогает соблюдать принцип DRY и делает код более чистым и простым для понимания. Базовые классы реализуют в себе распространенную(базовую) реализацию той или иной функциональности. От них можно наследоваться и расширять функциональность.

### Коммуникационный слой

Базовый класс Api представляет собой реализацию API-клиента, который позволяет отправлять запросы на сервер с помощью HTTP-методов GET, POST, PUT и DELETE.

#### Параметры конструктора

* `baseUrl`: базовый URL, который будет использоваться для отправки запросов на сервер.
* `options`: объект, который содержит дополнительные опции для отправки запросов. По умолчанию, этот объект пустой.

#### Свойства

* `baseUrl`: базовый URL, который будет использоваться для отправки запросов на сервер.
* `options`: объект, который содержит дополнительные опции для отправки запросов.

### Методы

#### GET-запрос

* `get(uri: string)`: отправляет GET-запрос на сервер по указанному URI.

#### POST-запрос

* `post(uri: string, data: object, method: ApiPostMethods = 'POST')`: отправляет POST-запрос на сервер по указанному URI с переданными данными. Метод по умолчанию - 'POST', но также можно указать 'PUT' или 'DELETE'.

### Обработка ответа

* `handleResponse(response: Response)`: обрабатывает ответ от сервера. Если ответ успешный (200-299), метод возвращает данные в формате JSON. Если ответ неуспешный, метод возвращает ошибку с текстом ошибки.

### Опции запроса

* `headers`: объект, который содержит заголовки запроса.
* `method`: метод запроса (GET, POST, PUT, DELETE).


### Слой отображения

Component это абстрактный класс, который предоставляет основные методы для работы с DOM-элементами и является основой для создания других компонентов.

#### Параметры конструктора

* `container`: корневой DOM-элемент, который будет использоваться для рендеринга компонента.

#### Свойства

* `container`: корневой DOM-элемент, который будет использоваться для рендеринга компонента.

### Методы

#### Работа с DOM-элементами

* `toggleClass(element: HTMLElement, className: string, force?: boolean)`: переключает класс у DOM-элемента.
* `setText(element: HTMLElement, value: unknown)`: устанавливает текстовое содержимое DOM-элемента.
* `setDisabled(element: HTMLElement, state: boolean)`: устанавливает статус блокировки DOM-элемента.
* `setHidden(element: HTMLElement)`: скрывает DOM-элемент.
* `setVisible(element: HTMLElement)`: показывает DOM-элемент.
* `setImage(element: HTMLImageElement, src: string, alt?: string)`: устанавливает изображение с алтернативным текстом у DOM-элемента.

#### Рендеринг

* `render(data?: Partial<T>): HTMLElement`: рендерит компонент и возвращает корневой DOM-элемент.


### Слой репрезентера

Класс EventEmitter не является абстрактным, а реализует простой брокер событий, поэтому является базовым.  

Этот класс позволяет устанавливать обработчики на события, инициировать события с данными и слушать все события.

### Интерфейс IEvents

Класс EventEmitter реализует интерфейс IEvents, который определяет следующие методы:

* `on<T extends object>(event: EventName, callback: (data: T) => void)`: устанавливает обработчик на событие.
* `emit<T extends object>(event: string, data?: T)`: инициирует событие с данными.
* `trigger<T extends object>(event: string, context?: Partial<T>)`: делает коллбек триггером, генерирующим событие при вызове.

### Методы

#### Установить обработчик на событие

* `on<T extends object>(eventName: EventName, callback: (event: T) => void)`: устанавливает обработчик на событие.

#### Снять обработчик с события

* `off(eventName: EventName, callback: Subscriber)`: снимает обработчик с события.

#### Инициировать событие с данными

* `emit<T extends object>(eventName: string, data?: T)`: инициирует событие с данными.

#### Слушать все события

* `onAll(callback: (event: EmitterEvent) => void)`: слушает все события.

#### Сбросить все обработчики

* `offAll()`: сбрасывает все обработчики.

#### Делать коллбек триггером

* `trigger<T extends object>(eventName: string, context?: Partial<T>)`: делает коллбек триггером, генерирующим событие при вызове.


### Слой данных

Класс `Model` - это абстрактный класс, который представляет собой основу для создания моделей данных. Он позволяет отличать модели от простых объектов с данными и предоставляет методы для работы с данными.

#### Конструктор

* `constructor(data: Partial<T>, protected events: IEvents)`: конструктор базовой модели, который принимает данные и экземпляр класса IEvents.

#### Emit Changes

* `emitChanges(event: string, payload?: object)`: метод, который сообщает всем, что модель поменялась. Он принимает имя события и данные, которые можно модифицировать.

#### Общие методы

* Этот класс позволяет добавлять общие методы для моделей, которые можно использовать в наследниках.

### Гарда для проверки на модель

* `isModel(obj: unknown): obj is Model<any>`: функция, которая проверяет, является ли объект экземпляром базовой модели.
