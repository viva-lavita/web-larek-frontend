# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```


--

## Архитектура

Архитектура проекта разрабатывается с использованием паттерна MVP, в котором основными слоями являются:

- `M` - модели данных, слой отвечающий за работу с данными;
- `V` - view, компоненты представления отвечающие за отображение данных, слой отображения;
- `P` - presenter - управляющий слой. Код презентера не выделен в отдельный класс, а содержится в основном скрипте приложения index.ts.

В проекте мы используем событийно-ориентированный подход.

Состояние приложения описывается через главную модель данных `AppData`, которая реализована с использованием паттерна Синглтон, а также использует композицию классов,

### Модели данных

Модель, отвечающая за получение данных о товарах с сервера. \n
Несмотря на то, что ограничения `categoryType` после компиляции в js полностью исчезнут, а занчение данного поля приходит с сервера, данное выделение вариантов здесь указано большей частью для поддержания стилистики максимальной типизации и облегчения понимания кода.

```ts

type categoryType =
	| 'софт-скил'
	| 'другое'
	| 'дополнительное'
	| 'кнопка'
	| 'хардскил';

export type IItemServe = {
	id: string;
	title: string;
	price: number | null;
	description: string;
	image: string;
	category: categoryType;
};

```

--

Расширенный тип данных товара. \n
Этот тип данных используется для описания данных, которые возвращаются из функции получения данных с сервера. \n

Добавлены поля:

- selected - вынесенный в отдельное поле флаг выбора товара пользователем.
- index - опциональное поле, используется для отображения порядкового номера товара в корзине, вместо динамической нумерации по факту при отображении модального окна корзины.

Цель выноса в отдельные поля - меньшая нагрузка на браузер пользователя. Обмен памяти на быстродействие.

Также скорректирован тип входящих данных поля price - null заменен на 0, полностью приведено к number.

```ts

export type IItem = IItemServe & {
	price: number;
	selected: boolean;
	index?: number;
};

```

--

Интерфейс модели хранения информации о товаре. \n
Прописаны методы получения товара по id и выбора товара пользователем (изменение флага selected). Удобно использовать при отображении карточек. \n
id в формате string, так в бд сервера используются pk формата UUID.

```ts

export interface IItemsData {
	items: IItem[];
	selectItem(id: string): void;
	getItem(id: string): IItem | null;
}

```

--

Интерфейс класса получения данных о товаре с сервера. \n

Прописаны методы получения одного или нескольких товаров, получение одного товара в приложении не используется, но данный интерфейс присутствует в серверном API.

```ts

export interface IItemAPI {
	getItems(): Promise<IItem[]>;
	getItem(id: string): Promise<IItem>;
	makeOrder(order: IOrderData): Promise<IOrderResponse | OrderError>;
}

```

--

Класс хранения состояния корзины. \n
Прописаны методы добавления, удаления и очистки корзины. \n 
При удалении и очистке сбрасываются или пересчитываются индексы товаров.

Индексы используются только корзиной, поэтому работа с ними ведется только в этом классе, при выходе за его пределы индексы сбрасываются. Флаг же selected используется только классом товара, поэтому работа с ним прописана в классе ItemsData.

```ts

export interface IBasketData {
	items: IItem[];
	totalPrice: number;
	addItem(item: IItem): void;
	removeItem(item: IItem): void;
	clearBasket(): void;
}

```

--

Интерфейсы классов отображения форм оформления заказа. \n
В приложении две формы, поэтому используется два класса отображений. \n

Метод render прописан в абстрактном классе, от которого наследуются эти классы форм.
По дефолту в форме заказа выбирается (и отображается) форма оплаты `online`.

```ts

export type ITypePayment = 'cash' | 'online';

export interface IOrderForm {
	payment: ITypePayment;
	address: string;
}

export interface IOrderContactForm {
	email: string;
	phone: string;
}

```

--

Тип описывающий данные, которые необходимы для отправки заказа на сервер. \n
Данный тип используется только в методе getOrder и классе API - как описание структуры передаваемого аргумента, поэтому реализовано как тип, а не интерфейс.

```ts

type IOrder = IOrderForm & IOrderContactForm & {
    total: number;
    items: IItem['id'][];
}

```

--

Класс хранения информации о текущем заказе. \n
Прописаны методы добавления, удаления товаров из корзины, очистка корзины и получение заказа для отправки на сервер. \n
Работа с данными ведется только через интерфейс.

```ts

export interface IOrderData extends IOrder {
	addItem(item: IItem): void;
	removeItem(item: IItem): void;
	clearOrder(): void;
    getOrder(): IOrder;
}

```

--

Описание структуры вариантов ответов сервера, после обработки функцией `makeOrder` в классе ItemAPI - успешный заказ и ошибка. \n
Ошибка является классом,  вызывается в функции makeOrder и расширяет базовый класс Error, поэтому реализована интерфейсом, а не типом.

```ts

export type IOrderResponse = {
  id: string;
  total: number;
}

export interface IOrderError extends Error {
	error: string;
}

```

--

Описание структуры поля сохранения ошибок валидации форм. \n
Объект ключ-значение формата строки, пример {'phone': 'Поле номера телефона должно быть заполнено'}.

```ts

export type FormErrors = Record<string, string>;

```

--

Класс управления состоянием приложения. \n
Интерфейс IAppData представляет состояние приложения и предоставляет методы для работы с этим состоянием. Класс управляет данными, связанными с товарами, корзиной покупок, оплатой и заказами, а также выполняет бизнес-логику, связанную с обработкой этих данных.

Свойства

- **items**: IItem[]  
  Хранит список доступных товаров.

- **basket**: IItem[]  
  Хранит товары, выбранные пользователем.

- **totalPrice**: number  
  Содержит общую стоимость товаров в корзине.

- **preview**: IItem | null  
  Позволяет пользователю просматривать информацию о выбранном товаре. Может быть null, если предварительный просмотр не установлен.

- **formErrors**: FormErrors  
  Хранит ошибки валидации формы, возникающие при проверке данных заказа или контактной информации.

Методы

- **getOrder**: () => IOrder  
  Получает текущий заказ, включая информацию о товарах и способе оплаты.  
  **Возвращает**: Объект текущего заказа.

- **setCatalog**: (items: IItem[]) => void  
  Устанавливает каталог товаров, обновляя список доступных товаров в приложении.  
  **Параметры**:
  - items: Новый список товаров.

- **selectItem**: (item: IItem) => void  
  Выбирает товар и добавляет его в корзину покупок.  
  **Параметры**:
  - item: Товар для выбора.

- **unselectItem**: (item: IItem) => void  
  Отменяет выбор товара и удаляет его из корзины покупок.  
  **Параметры**:
  - item: Товар для отмены выбора.

- **setPreview**: (item: IItem) => void  
  Устанавливает предварительный просмотр выбранного товара.  
  **Параметры**:
  - item: Товар для предварительного просмотра.

- **setPayment**: (payment: ITypePayment) => void  
  Устанавливает способ оплаты для текущего заказа.  
  **Параметры**:
  - payment: Способ оплаты.

- **setOrderField**: (field: keyof Pick<IOrderData, 'payment' | 'address'>, value: string) => void  
  Устанавливает значение поля заказа (например, адрес или способ оплаты).  
  **Параметры**:
  - field: Поле заказа для обновления.
  - value: Новое значение поля.

- **setOrderFieldContacts**: (field: keyof Pick<IOrderData, 'email' | 'phone'>, value: string) => void  
  Устанавливает значение контактного поля заказа (например, email или телефон).  
  **Параметры**:
  - field: Поле контакта для обновления.
  - value: Новое значение поля контакта.

- **validateOrder**: () => boolean  
  Проверяет валидность данных заказа.  
  **Возвращает**: true, если данные валидны; иначе false.

- **validateContacts**: () => boolean  
  Проверяет валидность контактных данных пользователя.  
  **Возвращает**: true, если данные валидны; иначе false.

- **clearBasket**: () => void  
  Очищает корзину покупок, удаляя все товары из нее.

```ts

export interface IAppData {
	items: IItem[];
	basket: IItem[];
	totalPrice: number;
	preview: IItem | null;
	formErrors: FormErrors;
	getOrder: () => IOrder;
	setCatalog: (items: IItem[]) => void;
	selectItem: (item: IItem) => void;
	unselectItem: (item: IItem) => void;
	setPreview: (item: IItem) => void;
	setPayment: (payment: ITypePayment) => void;
	setOrderField: (
		field: keyof Pick<IOrderData, 'payment' | 'address'>,
		value: string
	) => void;
	setOrderFieldContacts: (
		field: keyof Pick<IOrderData, 'email' | 'phone'>,
		value: string
	) => void;
	validateOrder: () => boolean;
	validateContacts: () => boolean;
	clearBasket: () => void;
}

```